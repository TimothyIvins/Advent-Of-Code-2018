const input = String.raw 
`                                 /-----------------------------------------------\                                 /-------------------\              
  /------------------------------+-------------------------------------------\   |/--------------------------------+---------------\   |              
  |                              |                                           |   ||                    /-----------+---------------+---+-------------\
  |      /-----------------------+-------------------------------------------+---++--------------------+----------\|               |   |             |
  |   /--+-----------------------+-------------------\                       |   ||                    |          ||               |   |             |
  |   |  |                       |       /-----------+-----------------------+---++--------------------+----------++---------------+---+------\      |
  |   |  |   /-------------------+-------+-----------+-----------------------+---++--------------------+-----\    ||               |   |      |      |
  |   |  |   |                   |       |           |                       |   ||                    |     |    ||               |   |      |      |
  |   |  |   |                   |       |           |        /--------------+---++-----------------\  |     |    ||               |   |      |      |
  |   |  |   |                   |       |           |        |              |   ||                 |  |     |    ||               |   |      |      |
  |   |  |   |   /---------------+---\/--+-----------+--------+--------------+---++-----------------+--+-----+----++---------------+-\ |      |      |
  |   |  |   |   | /-------------+---++--+-----------+--------+--------------+---++\                |  |     |    ||               | | |      |      |
/-+---+--+---+---+-+-------------+---++--+-----------+--------+--------------+---+++--\             |  |     |    ||               | | |      |      |
|/+---+--+---+--\| |           /-+---++--+-----------+--------+--------\     |   |||  |             |  |     |    ||               | | |      |      |
|||   |  |   |  || |        /--+-+---++--+-----------+-----\  |/-------+-----+---+++--+-------------+--+-----+----++---------------+-+-+--\   |      |
||| /-+--+---+--++-+--------+--+-+---++--+-----------+-----+--++-------+-----+--\|||  |           /-+--+-----+----++---------------+-+-+--+---+----\ |
||| | |  |   |  || |  /-----+--+\|   ||  |           |     |  ||       |     |  ||||  |           | |  |     |    ||               | | |  |   |    | |
||| | |  |/--+--++-+--+--\  |  |||   ||  \-----------+-----+--++-------+-----+--++++--+-----------+-+--+-----+----++---------------+-+-+--+---/    | |
||| | |  ||  |  || |/-+--+--+--+++---++--------------+-----+--++-------+-----+--++++--+-----------+-+--+-----+----++--------\      | | |  |        | |
||| | |  ||  |  || || |  | /+--+++---++-------\      |/----+--++-------+-----+--++++--+-----------+-+--+-----+----++--------+------+\| |  |        | |
||| | |  ||  |  || || |  | ||  |||   ||       |      ||    |  || /-----+-----+--++++--+-----------+-+--+-----+----++--\     |      ||| |  |        | |
||| | |  ||  |  || || |  | ||  |||   ||      /+------++----+--++-+--\  |     |  ||||  |           | |  |     |    ||  |     |      ||| |  |        | |
|||/+-+--++--+--++-++-+--+-++--+++---++\     ||      ||    |  || |  |  |     |  ||||  |           | v  |     |    ||  |     |      ||| |  |        | |
||||| |  ||  |  || || |  | ||  |||   |||     ||      ||    |  || |  |/-+-----+--++++--+-----------+-+--+-----+----++--+-----+------+++-+--+---\    | |
|\+++-+--++--+--/| || |  | ||  |||   |||     ||      ||    |  || |  || |     |/-++++--+-----------+-+--+-----+----++--+----\|      ||| |  |   |    | |
\-+++-+--++--+---+-++-+--+-++--+++---+++-----++------++----+--++-+--++-+-----++-++++--/           | |  |     |    ||  |    ||      ||| |  |   |    | |
  ||| |  ||  |   | || |  | ||  |||   |||     ||      ||    |  ||/+--++-+-----++-++++--------------+-+--+-\   |    ||  |    ||      ||| |  |   |    | |
  ||| |  ||  |   |/++-+--+-++--+++---+++-----++------++----+--++++--++-+-----++-++++--------------+\|/-+-+---+----++--+----++------+++-+--+---+--\ | |
  ||| |  ||  |   |||| |  | ||  |||   |||     ||      ||/---+--++++--++-+-----++-++++--------------++++-+-+---+----++--+----++------+++-+\ |   |  | | |
  \++-+--++--+---++++-+--+-++--+++---+++-----++------+++---+--++++--++-+-----/| ||||              |||| | |   |    ||  |    ||      ||| || |   |  | | |
   || |  ||  |   |||| |  | || /+++---+++-----++------+++---+--++++--++-+------+-++++--------------++++-+-+---+----++--+----++------+++\|| |   |  | | |
   || |  ||  |   |||| \--+-++-++/|   |||     ||      |||   |  ||||  || |      | ||||              |||| | |  /+----++--+----++--\   |||||| |   |  | | |
   || |  ||  |   ||||    | || || |/--+++-----++------+++--\|  ||||  || |/-----+-++++--------------++++-+-+\ ||    ||  |    ||  |   |||||| |   |  | | |
  /++-+--++\ |   ||||  /-+-++-++-++--+++-----++------+++--++--++++--++-++-----+-++++-------------\|||| | || ||    ||  |    ||  |   |||||| |   |  | | |
  ||| |  ||| |   ||||  | | || || ||  |||   /-++------+++--++--++++--++-++-----+-++++-------------+++++-+-++-++-\  ||  |    ||  |   |||||| |   |  | | |
  ||| |  ||| |   ||||  | | || || || /+++---+-++------+++--++--++++--++-++-----+-++++--\          ||||| | || || |  ||  |    ||  |   |||||| |   |  | v |
/-+++-+--+++-+---++++--+-+-++-++-++-++++---+-++------+++\ ||  |\++--++-++-----+-++++--+----------+++++-+-++-++-+--++--+----++--+---++++++-/   |  | | |
| ||| |  ||| |   ||||  | | || || || ||||   | ||      |||| ||  | ||  || ||     | ||||  |          ||||| | || || |  ||  |    ||  |   ||||||     |  | | |
| ||| |  ||| |   \+++--+-+-++-++-++-+/||   | ||      |||| ||/-+-++--++-++-----+-++++--+----------+++++-+-++\|| |  ||  |    ||  |   ||||||     |  | | |
| ||| |  ||| |    |||  | | || || || | ||   | ||      |||| ||| | ||  || || /---+-++++--+----------+++++-+-+++++-+--++--+----++--+---++++++---\ |  | | |
| ||| |  ||| |    |||  | | || || || | ||/--+-++------++++-+++-+-++--++-++-+---+-++++--+----------+++++-+-+++++\|  ||  |    ||  |   ||||||   | |  | | |
| ||| | /+++-+----+++--+-+-++-++-++-+-+++--+-++--\   |||| ||| | ||  || || |   | ||||  |          ||||| | |||||||  ||  | /--++--+---++++++---+-+\ | | |
| ||| | |||| |    |||  | | |\-++-++-+-+++--+-++--+---++++-+/| | ||  || || |   | ||||  |          ||||| | |||||||  ||  | |  ||  |   ||||||   | || | | |
| ||| | |||| |/---+++--+-+-+--++-++-+-+++--+-++--+---++++-+-+-+\|\--++-++-+---+-++++--+----------+++++-+-+++++++--++--/ |  ||/-+---++++++---+\|| | | |
| ||| | |||| ||   |||  |/+-+--++-++-+-+++--+-++--+---++++-+-+-+++---++\|| |   | ||||  |    /-----+++++-+-+++++++--++----+\ ||| |   ||||||   |||| | | |
| ||| | |||| ||   |||  ||| |  || || | |||  | ||  |   |||| | | |||   ||||| |   | ||||  |    |     ||||| | |||||||  ||    || ||| |   ||||||   |||| | | |
| ||| | |||| ||   |||  ||| |  || ||/+-+++--+-++--+---++++-+-+-+++---+++++-+---+-++++--+----+-----+++++-+-+++++++--++---\|| ||| |   ||||||   |||| | | |
| |\+-+-++++-++---+++--+++-+--++-++++-+/| /+-++--+---++++-+-+-+++-\ ||||| |   | ||||  |    |     ||||| | |||||||  ||   ||| ||| |   ||||||   |||| | | |
| | | | |||| ||   |||  ||| |  || |||| | | || ||  |   |||| | | ||| | ||||| |/--+-++++--+----+-----+++++-+-+++++++--++-\ |||/+++-+---++++++---++++\| | |
| | | | |||| ||   |||  ||| |  |\-++++-+-+-++-++--+---++++-+-+-+++-+-+++/| ||  \-++++--+----+-----+++++-+-+++++++--++-+-++++/|| |   ||||||   |||||| | |
| | | | |||| ||   |||  ||| |  |  |||| | | || ||  |   |||| | | \++-+-+++-+-++----++++--+----+-----+++/| | |||||||  || | |||| || |   ||||||   |||||| | |
| | | | |||| ||   |||  ||| |  |/-++++-+-+-++-++--+---++++-+-+--++-+-+++-+\||    ||||  |    |     ||| \-+-+++++++--++-+-++++-++-+---++++++---+++++/ | |
| | | | ||||/++---+++-\||| |  || |||| | | || || /+---++++-+-+--++-+-+++-++++----++++--+----+-----+++-\ | |||||||  || | ||||/++-+---++++++---+++++\ | |
| | | | |v|||||   ||| |||| |  || |||| | | || || ||   |||| | |  || | ||| ||||    ||\+--+----+-----+++-+-+-+++++++--++-+-+++++++-+---/|||||   |||||| | |
| | | | |||||||   ||| |||| |  || |||| | | || || ||   |||| | |  || | ||| ||||    || |  |    |     ||| | \-+++++++--++-+-+++++++-+----+++++---++++++-+-/
| | | | |||||||   ||| |||| |  || |||| | |/++-++-++---++++-+-+--++-+-+++-++++----++-+--+----+-----+++-+---+++++++--++-+-+++++++-+----+++++---++++++\|  
| | | | |||||||   ||| |||| |  || |||| | |||| || ||   |||| | |/-++-+-+++-++++-\  || |  |    | /---+++-+---+++++++--++-+-+++++++\|    |||||   ||||||||  
| | | | |||||||   ||| |||| |  || |||| | |||| || ||   |||| | \+-++-+-+++-++++-+--++-+--+----+-+---+++-+---++/||||  || | |||||||||    |||||   ||||||||  
| | | | |||||||   ||| |||| |  || |||| | |||| ||/++---++++-+--+-++-+-+++-++++-+--++-+--+----+-+---+++-+---++-++++\ || | |||||||||    |||||   ||||||||  
| | | | |||||||   ||| |||| |  || |||| | |||| |||||   |||| |  | || | ||| |||| |  || |  |    | |   ||| |   || ||||| || | |||||||||    |||||   ||||||||  
| | | \-+++++++---+++-++++-+--++-++++-+-++++-+++++---/||| |  | || | ||| |||| |  || |  |   /+-+---+++-+---++-+++++-++-+-+++++++++----+++++---++++++++\ 
| | |   |||||||   ||| |||| |/-++-++++-+-++++-+++++----+++-+--+-++-+-+++-++++-+--++-+--+\  || |   ||| |   || ||||| || | |||||||||    |||||   ||||||||| 
| | |   ||||||| /-+++-++++-++-++-++++-+-++++-+++++----+++-+--+-++-+-+++-++++-+--++>+--++\ || |   ||| |   || ||||| || | |||||||||    |||||   ||||||||| 
| | |   |||||||/+-+++-++++\|| || |||| | |||| |||||   /+++-+--+-++-+-+++-++++-+--++-+--+++-++-+--\||| |   || |||||/++-+-+++++++++----+++++--\||||||||| 
| | |   ||||||||| ||| ||||||| || |||| | |||| |||||   |||| |/-+-++-+-+++-++++-+--++-+--+++-++-+--++++-+--\|| |||||||| | |||||||||    |||||  |||||||||| 
\-+-+---+++++++++-+++-+++++++-++-++++-+-++++-+++++---+++/ || | || | ||| |||| | /++-+--+++-++\|  |||| |  ||| |||||||| | |||||||||    |||||  |||||||||| 
  | |   ||||||||^ ||| ||||||| || |||| | |||| \++++---+++--++-+-++-+-/|| |||| | ||| |  ||| ||||  |||| |  ||| |||||||| | |||||||||    |||||  |||||||||| 
  | |   ||||||||| ||| ||||||| ^| |||| | ||||  ||||   |||  || | || |  || |||| | ||| |  ||| ||||  |||| |  ||| |||||||| | |||||||||    |||||  |||||||||| 
  | |   ||||||||| ||| ||||||| || |||| | ||||  ||||   |||  || | || |  || |||| |/+++-+--+++<++++--++++-+--+++-++++++++-+\|||||||||    |||||  |||||||||| 
  | |   ||||||||| ||| ||||||| || |||| | ||||  ||||   |||  || | || |  || |||| ||||| |  ||| ||||  |||| |  ||| |||||||| |||||||||||    |||||  |||||||||| 
  | |   ||||||||| ||\-+++++++-++-++++-+-++++--++++---+++--++-+-++-+--++-++++-+++++-+--+++-++++--++++-+--+++-++++++++-+++++++/|||    |||||  |||||||||| 
  | |   ||||||||| ||  ||||||| || |\++-+-++++--++++---+++--/| | || |  || |||| ||||| |  ||| ||||  |||| |  ||| |||||||| ||||||| |||    |||||  |||||||||| 
  | |   ||||||||| ||  ||||||| || | || | ||||  ||||   |||   | | |\-+--++-++++-+++++-+--+++-++++--++++-+--+/| |||||||| ||||||| |||    |||||  |||||||||| 
  | |   ||||||||| ||  ||||||| || | || | ||||  ||||   |||   | | |  |  || |||| ||||| |  ||| ||||  |||| |  | | |||||||| ||||||| |||    |||||  |||||||||| 
  | |   ||||||||| ||  ||||||| || \-++-+-++++--++++---+++---+-+-+--+--++-++++-++++/ |  ||| ||||  |||| |  | | |||||||| ||||||| |||    |||||  |||||||||| 
  | |   ||||||||| ||  ||||||| ||   || \-++++--++++---+++---+-+-+--+--++-++++-++++--+--+++-++++--++++-+--+-+-++++++++-+++++++-+++----+/|||  |||||||||| 
  | |   ||||||||| ||  ||||||| ||   ||   ||||  ||||   |||   \-+-+--+--++-++++-++++--+--+++-++++--++++-+--/ | |||||||| ||||||| |||    | |||  |||||||||| 
  | |   ||||\++++-++--/|||||| ||   ||   ||||  ||||   |||     | |  |  || |||| ||||  |  ||| \+++--++++-+----+-++++++++-+++++++-+++----+-+++--+++++++++/ 
  \-+---+++/ |||| ||   |||||| ||   ||   ||||  ||||   |||     | |  |  || |||| ||||  |  |||  |||  |||| |    | |||||||| ||||||| |||    | |||  |||||||||  
    |   |||  |||| ||   |||||| ||   ||   ||||  ||||   |||     | |  |  || |||| ||||  |  |||  |||  |||| |    | |||||||| ||||||| |||    | |||  |||||||||  
    |   |||  |||| ||   |||||| || /-++---++++-\||\+---+++-----+-+--+--++-++++-++++--+--+++--+++--++++-/    | |||||||| |||\+++-+++----+-+++--++++/||||  
    |   |||  |||| ||   |||||| || | ||   |||| ||| |   |||     | |  |  \+-++++-++++--+--+++--+++--++++------+-++++++++-+++-+++-+++----+-+++--+++/ ||||  
    |   |||  |||| |^   |||||| || | ||   |||| ||| |   |||     | |  |   | |||| ||||  |  |||  |||  |||| /----+-++++++++-+++-+++-+++----+-+++-\|||  ||||  
    |   |||  |||| ||   ||||\+-++-+-++---++++-+/| |   |||     | |  |   | |||| ||||  |  |||  |||  |||| |    | |||||||\-+++-+++-+++----+-+/| ||||  ||||  
    |   |||  |||| \+---++++-+-++-+-++---++++-+-+-+---+++<----+-+--+---+-++++-++++--+--+++--+++--+++/ |    | |||||||  ||| ||| |||    | | | ||||  ||||  
    |   |||  ||||  |   |||| | || | ||   |||| | | |   \++-----+-+--+---+-++++-++++--+--+++--+++--/|\--+----+-+++++++--+++-+++-+++----+-+-+-++++--+++/  
    |   |||  ||||  |   |||| | || | ||   |||| | | |    ||   /-+-+--+---+-++++-++++--+--+++--+++---+---+----+-+++++++--+++-+++\|||    | | | ||||  |||   
    |   |||  ||||  |   |||| | || | ||   ||\+-+-+-+----++---+-+-+--/   | |||| ||||  |  |||  |||   |   |    | |||||||  ||| |||||||    | | | ||||  |||   
    |   |||  ||||  |   |||| | || | ||   || | | | |    ||   | | |      | |||| ||||  |/-+++--+++---+---+----+-+++++++-\||| |||||||    | | | ||||  |||   
    |   |||/-++++--+---++++-+-++-+-++---++-+-+-+-+----++---+-+-+---\  | |||| ||||  || |||  |||   |   |    | |||||||/++++-+++++++----+-+-+-++++-\|||   
    |   |||| ||||  |   |||| | || | ||   || |/+-+-+----++---+-+-+---+--+-++++-++++--++-+++--+++---+---+----+-++++++++++++-+++++++----+-+-+-++++-++++-\ 
    |   |||| ||||  |   |||| | || | ||   || ||| | |  /-++---+-+\|   |  | |||| ||||  || |||  |||   |   |    | |||||||||||| |||||||    | | | |||| |||| v 
    |   |||| ||||  |   |||| | || | ||   || ||| | |  | ||   | |||   |  | |||| ||||  || |||  |||   |   |    | |||||||||||| |||||||    | | | |||| |||| | 
    |   |||| \+++--+---++++-+-++-+-++---++-+++-+-+--+-++---+-+++---+--+-++++-++++--++-+++--+++---+---+----+-+/|||||||||| |||||||    | | | |||| |||| | 
    |   ||||  |||  |   |||| | || | ||/--++-+++-+-+--+-++---+-+++---+--+-++++-++++--++-+++--+++---+---+\   | | |||||||||| |||||||    | | | |||| |||| | 
    |   ||||  |||  |   |||| | || | |||  || ||| | |  |/++---+-+++---+--+-++++-++++--++-+++--+++---+---++---+-+-++++++++++-+++++++----+-+\| |||| |||| | 
    |   ||||  |||  \---++++-+-++-+-+++--++-+++-+-+--++++---+-+++---+--+-++++-++++--/| |||  |||   |   ||   | | |||||||||| |||||||    | ||| |||| |||| | 
 /--+---++++--+++------++++-+-++-+-+++--++-+++-+-+\ ||||   | |||   |  | |||| ||||   | |||  |||   |   ||   | | |||||||||| |||||||    | ||| |||| |||| | 
 |  \---++++--+++------++++-+-++-+-+++--++-+++-+-++-++++---+-+++---+--+-++++-+++/   | |||  |||   |   ||   | | |||||||||| |||||||    | ||| |||| |||| | 
 |      ||||  |||      |\++-+-++-+-+++--++-+++-+-++-++++---+-+++---+--/ |||| |||    \-+++--+++---+---++---+-+-++++++/||| |||||||    | ||| |||| |||| | 
 |      |||\--+++------+-++-+-++-+-+++--++-+++-+-++-++++---+-+++---/   /++++-+++------+++--+++---+---++---+-+-++++++-+++-+++++++----+-+++-++++-++++-+\
 |      ||\---+++------+-/| | || | |||  || ||| | || ||||   | |||       ||||| |||      |||  |||   |   \+---+-+-++++++-+++-+++++++----+-+++-/||| |||| ||
 |      ||    |||      |  | | || | |||  || ||| | || ||||   | |||       ||||| |||      |||  |||   |    |   | | |||||| ||| |||||||    | |||  ||| |||| ||
 |      ||    |||      |  | | || | |||  || ||| | || ||||/--+-+++-------+++++-+++------+++--+++\  |    |   | | |||||| ||| |||||||    | |||  ||| |||| ||
/+------++----+++\     |  | | || | |||  || |\+-+-++-+++++--+-+++-------+++++-+++------+++--++++--+----+---+-+-++++++-+++-+++++++----+-+++--+++-++++-/|
||      ||    |\++-----+--/ | || | ||| /++-+-+-+-++-+++++--+-+++-------+++++-+++------+++--++++--+----+---+-+\|||||| ||| |||||||    | |||  ||| ||||  |
||      |\----+-++-----+----+-++-+-+++-+++-+-+-+-++-+++++--+-+++-------+++++-+++------+++--++++--+----+---+-++++++/| ||| |||||||    | |||  ||| ||||  |
||      |     | ||     |    | \+-+-+++-+++-+-+-+-++-+++++--+-+++-------+++++-+++------+++--++++--+----+---+-++++++-+-+++-+++++++----+-/||  ||| ||||  |
||      |     \-++-----+----+--+-+-+++>+++-+-+-+-++-+++++--+-++/       ||||| |||      |||  ||||  |    |   | ||||||/+-+++-+++++++----+--++--+++\||||  |
||/-----+-------++-----+----+--+-+-+++\||| | | | || |||||  \-++--------+++++-+++------+++--++++--+----+---+-++++++++-+++-+++/|||    |  ||  ||||||||  |
|||     |       ||     |    |  | | |||||\+-+-+-+-++-+++++----++--------+++++-+++------+++--++++--+----+---+-++/||||| ||| ||| |||    |  ||  ||||||||  |
|||     |       ||     |    |  | | ||||| | | | | || ||\++----++--------+++++-+++------+++--++++--+----+---+-++-+++++-+++-+++-+++----/  ||  ||||||||  |
|||   /-+-------++-----+-\  |  | | |\+++-+-+-+-+-++-++-++----++--------+++++-+++------/||  ||||  |    |   | || ||||| ||| ||| \++-------++--++/|||||  |
|||   | |       ||     | |  |  | | | ||| | | | | || || ||    ||        ||||| |||       || /++++--+----+---+-++-+++++-+++-+++--++-------++--++-+++++\ |
|||   | |       ||     | |  |  | | | ||| | | | | || || ||    ||/-------+++++-+++-------++-+++++--+----+--\| || ||||| ||| |||  ||       ||  || |||||| |
|||   | \-->----++-----+-+--+--+-+-+-+++-+-+-+-+-/| || ||    |||       ||||| ||\-------++-++/||  |    |  || || ||||| ||| |||  ||       ||  || |||||| |
\++---+---------+/     | |  |  | | | ||| | \-+-+--+-++-++----+++-------+++++-++--------++-++-++--+----+--++-++-/|||| ||| |||  ||       ||  || |||||| |
 ||   |         |      | |  |  | | | ||| |   | |  | || ||    |||       ||||| |\--------++-++-++--+----+--++-++--++++-+/| |||  ||       ||  || |||||| |
 ||   |         |      | |  |  |/+-+-+++-+---+-+--+-++-++----+++-------+++++-+--\      || || ||  |    |  || ||  |||| | | |\+--++-------++--++-++/||| |
 ||   |         |      \-+--+--+++-+-+++-+---+-+--+-++-++----+++-------+++++-+--+------++-++-++--/    |  || ||  |||| | | | \--++-------++--++-++-/|| |
 ||   |         |        |  |/-+++-+-+++-+---+-+--+\|| ||    |||       ||||| |  |      || |\-++-------+--++-++--++++-+-+-/    ||       ||  || ||  || |
 ||   |         |        |  || ||| | ||| |   | \--++++-++----+++-------+++++-+--+------++-+--++-------+--++-++--/\++-+-+------++-------++--/| ||  || |
 ||   |         |        |  || ||| | \++-+---+----++++-++----+++-------+++++-+--+------++-+--++-------/  || ||    || | |      ||       ||   | ||  || |
 ||   |   /-----+--------+--++-+++-+--++-+---+-\  |||| ||    |||       |\+++-+--+------++-+--++----------+/ ||    || | |      ||       ||   | ||  || |
 ||   \---+-----+--------/  || ||| |  || |   | |  ||\+-++----+/|       | ||| |  |      || |  ||          |  ||    || | |      ||       ||   | ||  || |
 ||    /--+-----+-----------++-+++-+--++-+\  | |  || | ||    | |       | ||| |  |      || |  ||          |  ||    || | |      ||       ||   | ||  || |
 ||    |  |     |           || ||| |  || \+--+-+--++-+-++----+-+-------+-+++-+--+------++-+--++----------+--++----++-+-+------++-------++---+-++--/| |
 ||    |  |     |     /-----++-+++-+--++--+--+-+--++-+-++-\  | |       | ||| |  |      || |  ||          |  ||    || | |      ||       ||   | ||   | |
 ||    |  |     |     |     || ||| |  ||  |  | |  || | || |  | |       | ||| |  |      || \--++----------+--++----++-+-+------++-------++---+-++---/ |
 ||    |  |     |     |     || ||| |  ||  |  | |  || | |\-+--+-+-------+-+++-+--+------++----+/          |  \+----++-+-+------+/       ||   | ||     |
 \+----+--+-----+-----+-----++-+++-+--++--+--+-+--/| | |  |  | |       | ||| |  |      ||    |           |   |    || | |      |      /-++---+-++-\   |
  |    |  |     |     |     || ||| |  ||  |  | |   | | |  |  | |       | ||| |  |      ||    |           |   |    |v | |      |      | ||   | || |   |
  |    |  |     |     |     || |\+-+--++--+--+-+---+-+-+--+--+-+<------+-+++-+--/      ||    |           |   |    || | |      |      | ||   | || |   |
  |    |  |     |     |     || \-+-+--++--+--+-+---+-+-+--+--+-+-------+-/|| |         ||    |           |   |    || | |      |      | ||   | || |   |
  |    |  |     \-----+-----++---+-+--++--+--+-+-<-+-+-+--+--+-+-------+--++-+---------+/    |           |   |    || | |      |      | ||   | || |   |
  |    |  |           |     ||   | |  ||  |  | |   | | \--+--+-+-------+--++-+---------+-----+-----------+---+----++-+-+------+------+-+/   | || |   |
  |    |  |         /-+-----++---+-+--++--+--+-+---+-+----+--+-+-------+--++-+------\  |     |           |   |    || | |      |      | |    | || |   |
  |    |/-+---------+-+-----++\  | |  |\--+--+-+---+-+----+--+-+-------+--++-+------+--+-----+-----------+-->/    \+-+-+------+------+-+----+-/| |   |
  |    || \---------+-+-----+++--+-+--+---+--+-/   | |    |  | |       |  || |      |  |     |           |         | | |      |      | |    |  | |   |
  |    ||           | |     |||  | |  |   |  |     | |    |  | |       |  || |      |  |     |           |         \-+-+------+------+-+----+--/ |   |
  \----++-----------+-+-----+++--+-+--/   |  |     | |    |  \-+-------+--++-/      |  |     |           |           | |      |      | |    |    |   |
       ||           | |     |\+--+-+------+--+-----/ |    |    |       |  |\--------+--+-----+-----------+-----------/ |      |      | |    |    |   |
       ||           | |     | |  | |      |  |       \----+----+-------+--+---------+--+-----+-----------+-------------+------+------+-/    |    |   |
       \+-----------+-+-----+-+--+-+------/  |            |    |       |  |         |  |     \-----------+-------------+------/      |      |    |   |
        |           | |     \-+--+-+---------+------------+----+----->-+--+---------+--/                 |             |             \------+----/   |
        |           | |       |  \-+---------/            |    \-------+--+---------+--------------------/             |                    |        |
        \-----------+-+-------/    \----------------------+------------+--+---------+----------------------------------/                    |        |
                    | \-----------------------------------/            |  \---------+-------------------------------------------------------/        |
                    \--------------------------------------------------+------------/                                                                |
                                                                       \-----------------------------------------------------------------------------/`








const goLeft = { 'next': null, 'change': true, 'clockwise': false };
const goRight =  { 'next': goLeft, 'change': true, 'clockwise': true };
const goStraight =  { 'next': goRight, 'change': false };
goLeft['next'] = goStraight;

const cartLocator = {
  '^': {'direction': 0, 'trackPiece': '|'},
  '>': {'direction': 1, 'trackPiece': '-'},
  'v': {'direction': 2, 'trackPiece': '|'},
  '<': {'direction': 3, 'trackPiece': '-'}
};

class Cart {

  constructor (x, y, locator) {

    this.x = x
    this.y = y
    this.direction = cartLocator[locator]['direction']
    this.intersection = goLeft
    this.collided = false;

  }

  tick (tracks) {

    this.advance()
    this.setDirection(tracks)

  }

  advance () {

    const [ ix, iy ] = [[0, -1], [1, 0], [0, 1], [-1, 0]][this.direction]

    this.x += ix
    this.y += iy

  }

  setDirection (tracks) {

    const track = tracks[this.y][this.x]
    let clockwise

    if (['-', '|'].includes(track)) return

    if (track === '\\') {
      clockwise = [1, 3].includes(this.direction)
      this.redirect(clockwise)
      return
    }

    if (track === '/') {
      clockwise = [0, 2].includes(this.direction)
      this.redirect(clockwise)
      return
    }

    if (track === '+') {
      this.handleIntersection() 
      return
    }
 
  }

  redirect (clockwise) {

    if (clockwise) {
      this.direction = (this.direction + 1) % 4
    } else {
      this.direction = (this.direction + 3) % 4
    }
  }

  handleIntersection () {

    if (this.intersection['change']) {
      this.redirect(this.intersection['clockwise'])
    }
    
    this.intersection = this.intersection.next

  }

};

const createCartsAndTracks = (inputData) => {

  const carts = [];

  const tracks = inputData.split('\n').map((row, y) => {
    
    const cols = row.split('').map((char, x) => {
      if (!cartLocator[char]) return char;
      carts.push(new Cart(x, y, char));
      return cartLocator[char]['trackPiece'];
    });

    return cols;

  });

  return { carts, tracks };

};

const getCartSortValue = (x, y, rowLength) => {

  return (y * rowLength) + x;

}

const findCollision = (carts) => {
  
  const locations = {};
  let location;

  for (cart of carts) {

    if (cart['collided']) continue;
    
    location = cart['x'] + ',' + cart['y'];

    if (locations[location]) return location;

    locations[location] = true;
  }

  return null;

};

const markCartsCollided = (carts, x, y) => {

  carts.forEach (cart => {
      if (cart['x'] === x && cart['y'] === y) cart['collided'] = true;
  });

};

const part1 = (input) => {

  const { carts, tracks } = createCartsAndTracks(input);
  const rowLength = tracks[0].length;
  const result = {};
  let found = false;
  
  while (!found) {

    for (cart of carts) {

      cart.tick(tracks);
      if (findCollision(carts)) {
        result['x'] = cart['x'];
        result['y'] = cart['y'];
        found = true;
        break;
      };
  
    };

    carts.sort((c1, c2) => (getCartSortValue(c1['x'], c1['y'], rowLength) - getCartSortValue(c2['x'], c2['y'], rowLength)));
  
  };

  return result;

};

const part2 = (input) => {

  const { carts, tracks } = createCartsAndTracks(input);
  const rowLength = tracks[0].length;
  let cartCount = carts.length;
  
  while (cartCount > 1) {

    for (cart of carts) {

      if (!cart['collided']) {

        cart.tick(tracks);
        if (findCollision(carts)) {
          markCartsCollided(carts, cart['x'], cart['y']);
        };
      
      };

    };

    carts.sort((c1, c2) => (getCartSortValue(c1['x'], c1['y'], rowLength) - getCartSortValue(c2['x'], c2['y'], rowLength)));

    cartCount = carts.filter(cart => !cart['collided']).length;
  
  };

  const result = carts
                  .filter(cart => !cart['collided'])
                  .map(cart => {
                    const obj = {'x': cart['x'], 'y': cart['y']};
                    return obj;
                  })[0];
  return result;

};

console.log('Part 1:', part1(input));
console.log('Part 2:', part2(input));
